
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Weatherbuddy App</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid="UA-52746336-1"
                  id="weatherbuddy"
                  title="Weatherbuddy App"
                  environment="web"
                  feedback-link="https://github.com/hemchander23/weatherbuddy">
    
      <google-codelab-step label="About" duration="0">
        <h3 is-upgraded><strong>‚ÄòMint&#39;ing awesome Freshdesk Apps ‚Äî Creating a weather app using the latest Freshdesk SDKüë®‚Äçüíª</strong></h3>
<p>Apart from the cool features that Freshdesk inherently offers, it&#39;s marketplace adds additional value to the business through the <strong>apps</strong>. Freshdesk&#39;s app development platform enables us to create apps in no time powered by a wide range of platform APIs &amp; also offers scaffolding via the CLI. Freshdesk&#39;s ‚ÄòMint&#39; UI(hence the pun on the title) gives a crisp look and feel to our app <strong>out-of-the-box </strong>without breaking a sweat! However, as a developer I&#39;ve always believed in this :</p>
<p>&#34;Code aÃ∂cÃ∂tÃ∂iÃ∂oÃ∂nÃ∂ speaks louder than words&#34;</p>
<p>I went ahead to validate this using my ‚Äò<strong>Weather Buddy</strong>&#39;. As you may wonder who that person is, it&#39;s more of a neat sidebar extension than an actual person. Here&#39;s a quick sneak peak !</p>
<p class="image-container"><img style="width: 281.00px" src="img/60eaf2566bb49e04.png"></p>
<p>The app displays weather data for a given location and forecasts the same using the<a href="https://openweathermap.org/api" target="_blank"><strong>OpenWeatherMap API</strong></a>. It shows the temperature, windspeed, trend for the day and also stores the previously searched locations so that you can easily access them at a later point in time.</p>
<p> I&#39;ve uploaded the code to my<a href="https://github.com/hemchander23/weatherbuddy" target="_blank">Github repo</a> for reference. You can clone and run the same to see the magic immediately. Regardless, a short journey through our code will let us understand it better and create cool apps in the future.</p>
<p><strong><em>Prerequisites:</em></strong><em> Passion and Curiosity....sprinkled with some JS,HTML &amp; CSS....</em></p>


      </google-codelab-step>
    
      <google-codelab-step label="Setup &amp; Project structure" duration="0">
        <p>Before we dive head-first, we need to take care of the pre-reqs and dependencies. Make sure you have <strong>Node.js</strong> already installed along with the required tools as stated in the official<a href="https://developer.freshdesk.com/v2/docs/quick-start/" target="_blank"><strong>quick start</strong></a><strong> guide</strong>. </p>
<p>Once you are done, register on <strong>OpenWeatherMap and obtain an API key</strong>. It&#39;s used for fetching weather forecast data. This entry is also stored in <strong><em>iparam_test_data.json</em></strong>. Create a sample app using <strong>‚Äòfdk create&#39;</strong> (with the ‚Äòyour_first_app&#39; template). We will be building on top of this.</p>
<h3 is-upgraded><a href="https://github.com/hemchander23/weatherbuddy/blob/master/app/app.html#L3-L15" target="_blank"><strong>app/app.html</strong></a></h3>
<pre>&lt;head&gt;
  &lt;!-- Scripts --&gt;
  &lt;script src=&#34;https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js&#34;&gt;&lt;/script&gt;
  &lt;script src=&#34;//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js&#34;&gt;&lt;/script&gt;
  &lt;script src=&#34;https://static.freshdev.io/fdk/2.0/assets/fresh_client.js&#34;&gt;&lt;/script&gt;
  &lt;script src=&#34;https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js&#34;&gt;&lt;/script&gt;
  &lt;script src=&#34;https://cdnjs.cloudflare.com/ajax/libs/async/2.6.0/async.min.js&#34;&gt;&lt;/script&gt;
  &lt;script src=&#34;app.js&#34;&gt;&lt;/script&gt;
  &lt;!-- Stylesheets --&gt;
  &lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;res/css/style.css&#34;&gt;
  &lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;res/css/weather-icons.min.css&#34;&gt;
  &lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;https://static.freshdev.io/fdk/2.0/assets/freshdesk.css&#34;&gt;
&lt;/head&gt;</pre>
<p>In the template.html file, which gets generated by default, include Bootstrap, Weather Icons CSS,Async, Chart.js dependencies as well. </p>
<p>You can run the app from the CLI and test the local app by adding <strong>‚Äò?debug=true&#39;</strong> in the ticket URL.One good feature is the <strong>hot deployment of changes to the app </strong>whenever you save any file in the project. You don&#39;t have to run it every-time! Now when you hit this URL, you will see a hello-world app popping up in the side bar! </p>
<p><a href="https://heservice.freshdesk.com/a/tickets/3?dev=true" target="_blank">https://xxxxxxxxx.freshdesk.com/a/tickets/3<strong>?dev=true</strong></a></p>
<p>When in doubt, <strong>‚Äòfdk run&#39;</strong>..</p>
<h4 is-upgraded><strong>i. manifest.json: </strong></h4>
<p>The<a href="https://developer.freshdesk.com/v2/docs/app-manifest/" target="_blank">manifest.json</a> typically specifies the version, control placement, dependencies &amp; other meta information pertaining to our app. In our scenario, <strong>whitelisted-domains </strong>entry is maintained for the API apart from the usual settings. If not, our API calls wouldn&#39;t succeed.</p>
<h3 is-upgraded><strong>üí° </strong><strong><em>Tips:</em></strong></h3>
<ol type="1" start="1">
<li>By default, the sidebar app name is derived from the app directory name.</li>
<li>Make sure you have a clean 64x64 logo for your app else the run will error out!</li>
<li>Categorize your resource files into separate dirs and keep the root clean</li>
</ol>
<h4 is-upgraded><strong>ii. iparams.json</strong></h4>
<p>iparams specify the <strong>installation parameters</strong> that can be used to configure the app. In our case, we specify two entries in our iparams.json namely <strong><em>defaultLocation </em></strong>and <strong><em>weatherAPI</em></strong><em>. </em>These entries are the inputs obtained from the user during the installation of the app. In development mode, we can make use of <strong>iparam_test_data.json </strong>to set the values for the same. The API key that we obtained in the pre-requisite stage can be entered here.</p>
<p>iparam.json</p>
<p>The corresponding test values can be like so</p>
<h3 is-upgraded><strong>üí° Tip:</strong></h3>
<ol type="1" start="1">
<li>Do not place sensitive information inside HTML/JS/iparam.json as it can be traced from the dev console! Maintain keys locally using iparam_test_data.json</li>
</ol>
<p class="image-container"><img style="width: 374.00px" src="img/bc8b225e3c51ba0c.png"></p>
<p>Project structure</p>
<p>Notice that I&#39;ve renamed the default file names. This is the folder structure that we have now.</p>
<ol type="1" start="1">
<li><strong>/res ‚Äî </strong>Contains CSS, font(for weather-icons) &amp; image resources.</li>
<li><strong>app.html ‚Äî </strong>This is the view of our app where we make use of Bootstrap</li>
<li><strong>app.js ‚Äî </strong>Contains the logic for our application</li>
<li><strong>/config ‚Äî </strong>Contains the app parameter definitions. Test API key, Location defaults etc. can be maintained here during development. </li>
</ol>


      </google-codelab-step>
    
      <google-codelab-step label="UI - Front-end" duration="0">
        <p>The <strong>app.html</strong> in our project represents the front-end of our app. Note that I&#39;ve renamed the template.html to app.html (make sure to update the manifest as well). The app view will be adhering to the UI guidelines as stated in the official<a href="https://developer.freshdesk.com/v2/docs/ui-style-guide/" target="_blank">UI style guide</a>. Let&#39;s see what we have in there.</p>
<p><em>Structure of the view:</em></p>
<p>We can leverage bootstrap to create the UI that primarily consists of the following sections:</p>
<ol type="1" start="1">
<li><strong>Weather Gauge</strong> ‚Äî where it shows the temperature, wind-speed &amp; weather condition.</li>
<li><strong>Chart Area</strong> ‚Äî Shows the trend for the day !</li>
<li><strong>Forecast table</strong> ‚Äî Shows the forecast for the next 5 days. You can click on the date to see the weather for that day.</li>
</ol>
<p>An interesting thing in our view is the<a href="https://erikflowers.github.io/weather-icons/" target="_blank">weather icons</a> which contains icons tailored for Bootstrap and is compliant with the OpenWeatherAPI weather codes! </p>
<p class="image-container"><img style="width: 298.00px" src="img/eb068530458f8104.gif"></p>
<p>Icons convey a lot in a short span</p>
<h3 is-upgraded><strong>üí° Tip:</strong></h3>
<ol type="1" start="1">
<li>Stick to using the style sheet offered by Freshdesk. It is bootstrap compliant and blends our app with the tool.</li>
</ol>


      </google-codelab-step>
    
      <google-codelab-step label="Coding the logic" duration="0">
        <p class="image-container"><img style="width: 606.00px" src="img/30334510080e8c64.png"></p>
<p>On a high level, we call the weather API when the user inputs the location, process the data and store it locally for later retrieval. We also pick the default location from the iparam_test_data.json ‚Äî in our case, Chennai. Also, every time a search happens, we log it and show the recently searched places. We also plot a simple graph of the weather forecast using Chart.js based on the data that we fetch. </p>
<p>Before we dive into our JavaScript code, I&#39;d like to place a special emphasis on the Freshdesk APIs. These APIs are key to our app development &amp; almost all the features which I mentioned above require one or more of those APIs. Also, these APIs behave <strong>asynchronously</strong> ‚Äî meaning, if we sequence a bunch of async function calls one after the other, <strong>there is no guarantee that they will be executed in the order that we defined</strong>.However, they all get triggered almost at the same time and return the result of the processing <strong>in their own callback functions.</strong></p>
<p class="image-container"><img style="width: 587.00px" src="img/5c1162e2a9d9780c.png"></p>
<p>If we want to wait for the first async call to complete, we need to place the second async call in the <strong>callback method </strong>of the first async call. But is it a viable option in the long run? Definitely not, especially when there are several invocations. Although asynchronous invocations have their own advantages, we need to make sure we don&#39;t run into the<a href="https://colintoh.com/blog/staying-sane-with-asynchronous-programming-promises-and-generators" target="_blank">callback hell problem</a>. We make use of an external library called<strong> ‚Äòasync&#39; </strong>to take care of this.</p>
<p class="image-container"><img style="width: 382.00px" src="img/89bc129f8ed05665.png"></p>
<p>It was at this moment when Bill realized he needs ‚Äòasync&#39; library..</p>


      </google-codelab-step>
    
      <google-codelab-step label="Platform APIs to use" duration="0">
        <ol type="1" start="1">
<li><a href="https://developer.freshdesk.com/v2/docs/data-api/" target="_blank"><strong>Data APIs </strong></a>‚Äî Can be used to retrieve details of global account, tickets, email &amp; contacts</li>
<li><a href="https://developer.freshdesk.com/v2/docs/data-storage/" target="_blank"><strong>Data Storage APIs</strong></a>‚Äî Can be used to store and retrieve data. The data is stored per-account per-app basis. </li>
</ol>
<p>You can see the use of data &amp; data storage APIs in our code. For example, we get the ID of the logged-in user using the data API and use it to create the personalization key. This is the key against which search history is saved &amp; retrieved using the storage API. In our case, the last 5 searched locations.</p>
<p>3.<a href="https://developer.freshdesk.com/v2/docs/request-api/" target="_blank"><strong>Request APIs</strong></a>‚Äî Used for making secure API requests from our app. Make sure you whitelist the domain in the manifest.</p>
<p>4.<a href="https://developer.freshdesk.com/v2/docs/instance-api/" target="_blank"><strong>Instance APIs</strong></a><strong> </strong>‚Äî A single app could be in multiple locations and each of them is treated like an instance. Through the instance APIs, we can control the behavior &amp; properties of each instance.</p>
<p>Note that the APIs behave <strong>asynchronously</strong>. We write the follow-up logic in the corresponding success and error callbacks. </p>
<p>The apps have their own<a href="https://developer.freshdesk.com/v2/docs/app-lifecycle-events/" target="_blank">life-cycle</a>. You can write the hooks on the corresponding life-cycle event to get started. In our case, we initialize the weather gauge and pull search history in the <strong>app.initialized() </strong>event</p>
<p>This is the entry point where we also attach <strong>click </strong>and <strong>key-press events</strong> to other controls in the front-end. For. ex: When a user types the location / When the user wants to see the forecast for a location. Notice <strong>the lines 63‚Äì65 </strong>where we specify the sequence of execution for asynchronous functions using the <strong>async</strong> library. There are a couple of other functions that we use in our app as well.</p>
<p>i.<a href="https://github.com/hemchander23/weatherbuddy/blob/master/app/app.js#L215-L311" target="_blank"><strong>getWeather()</strong></a><strong> ‚Äî </strong>Gets the weather data from the API and persists it locally based on the location parameter. We set a TTL (time-to-live) of 1 hour to the data that we persist. Nobody likes stale weather information ! ;)</p>
<p>We make use of <strong>Data, Request &amp; Data Storage APIs</strong> in this function.</p>
<p>ii.<a href="https://github.com/hemchander23/weatherbuddy/blob/master/app/app.js#L191-L207" target="_blank"><strong>updateWeatherGauge()</strong></a>‚Äî Updates the first section where we need to show the current temperature, wind-speed and the respective icon. We make use of jQuery selectors to set the values. In complex views, we can make use of <strong>templating.</strong></p>
<p>iii.<a href="https://github.com/hemchander23/weatherbuddy/blob/master/app/app.js#L318-L370" target="_blank"><strong>plotWeather()</strong></a> ‚Äî Plots the temperature chart for the day. You can click on the dates in the forecast table and a new chart would be rendered. A really short snippet that makes use of <strong>external library</strong> ‚Äî charts.js</p>
<p>iv.<a href="https://github.com/hemchander23/weatherbuddy/blob/master/app/app.js#L146-L184" target="_blank"><strong>populateRecentSearchList()</strong></a>‚Äî Populates the recent search list by persisting the location entries.Makes use of <strong>data storage APIs</strong>.</p>
<p class="image-container"><img style="width: 384.00px" src="img/a00c6ec5fe8ffd41.gif"></p>
<p>You can refer the rest of the controller code<a href="https://github.com/hemchander23/weatherbuddy/blob/master/app/app.js" target="_blank">here</a></p>
<h3 is-upgraded><strong>üí° Tip:</strong></h3>
<ol type="1" start="1">
<li>Make sure that the key length does not exceed 30 characters while storing data using the data storage APIs.</li>
</ol>


      </google-codelab-step>
    
      <google-codelab-step label="Run is fun !" duration="0">
        <p>Although it may not be that fun when you are on the last mile of a 21 km marathon run, it is pretty much fun in the case of a <strong>fdk run!</strong></p>
<p class="image-container"><img style="width: 400.00px" src="img/3cb10f2e856a4510.gif"></p>
<p>Now that we have the right settings, the view &amp; the controller code in place, it&#39;s time to get it up and running!</p>
<p>The <strong>fdk run</strong> command runs your code locally and you can start testing your app by appending <strong>?debug=true</strong> in the browser. If you are aware of Hot module replacement concept, it would ring a bell soon. Any change to our development gets reflected to our app on freshdesk almost instantly! A coverage report is also generated at the end of our run.</p>
<p>When your development is complete, make sure to follow the<a href="https://developer.freshdesk.com/v2/docs/app-content-guidelines/" target="_blank">app guidelines</a> as they are necessary for publishing it to the marketplace!</p>
<h3 is-upgraded><strong>üí° Tip:</strong></h3>
<ol type="1" start="1">
<li>Try not to save the file if your code has incomplete changes. The validation code will break the run during hot deploy.</li>
<li>Remember to allow loading of unsafe scripts while you are in dev mode. </li>
<li>Freshdesk recommends a coverage of 80% for apps that are to be published in the public marketplace.</li>
</ol>
<p>Hope this tutorial provided a neat technical insight into building awesome apps in a short span! However, there are many features in the development platform using which you can build sophisticated apps! I&#39;d recommend you to check<a href="https://developer.freshdesk.com/v2/docs/quick-start/" target="_blank">this page</a> for more interesting stuff.</p>
<p>Until then, happy ‚Äòmint&#39;ing !</p>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/codelab-elements/native-shim.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/prettify.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/codelab-elements.js"></script>

</body>
</html>
